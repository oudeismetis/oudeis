+++
title = "Snowfox - A Cryptography Firefox Extension"
date = 2012-10-28T18:42:00Z
updated = 2012-10-28T18:42:39Z
tags = ["steganography", "encryption", "plugin", "firefox", "compression", "whitespace", "cryptography", "defense in depth"]
blogimport = true 
[author]
	name = "Edward Romano"
	uri = "https://plus.google.com/118036157148722337915"
+++

In a previous post, I discussed <a href="http://oudeismetis.blogspot.com/2012/09/security-through-obscurity-doesnt-have.html">"Security through Obscurity" and briefly touched on the concept of SNOW</a>.<br /><br />Here we'll look a little deeper at SNOW and showcase some of the work I have done with it.<br /><br /><b>Some technical&nbsp;back-story&nbsp;on SNOW:</b><br />I think the&nbsp;<a href="http://www.darkside.com.au/snow/">original&nbsp;author's website</a> says it best. . .<br /><br /><u>Whitespace Steganography</u><br /><blockquote class="tr_bq"><blockquote class="tr_bq"><i><span style="font-size: x-small;">The encoding scheme used by snow relies on the fact that spaces and tabs (known as whitespace), when appearing at the end of lines, are invisible when displayed in pretty well all text viewing programs. This allows messages to be hidden in ASCII text without affecting the text's visual representation. And since trailing spaces and tabs occasionally occur naturally, their existence should not be sufficient to immediately alert an observer who stumbles across them.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">The snow program runs in two modes - message concealment, and message extraction. During concealment, the following steps are taken.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">Message -&gt; optional compression -&gt; optional encryption -&gt; concealment in text</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">Extraction reverses the process.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">Extract data from text -&gt; optional decryption -&gt; optional uncompression -&gt; message</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">Each of the steps are described in detail below.</span></i></blockquote></blockquote><u>Compression</u><br /><blockquote class="tr_bq"><blockquote class="tr_bq"><i><span style="font-size: x-small;">The compression scheme used by snow is a fairly rudimentary Huffman encoding scheme, where the tables are optimised for English text. This was chosen because the whitespace encoding scheme provides very limited storage space in some situations, and a compression algorithm with low overhead was needed. In other words, short messages had to compress to even shorter data. Depending on the text, you can usually get 25 - 40% compression.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">If you want to compress a long message, or one not containing standard text, you would be better off compressing the message externally with a specialized compression program, and bypassing snow's optional compression step. This usually results in a better compression ratio.</span></i></blockquote></blockquote><u>Encryption</u><br /><blockquote class="tr_bq"><blockquote class="tr_bq"><i><span style="font-size: x-small;">The encryption algorithm built in to snow is ICE, a 64-bit block cipher also designed by the author of snow. It runs in 1-bit cipher-feedback (CFB) mode, which although inefficient (requiring a full 64-bit encryption for each bit of output), provides the best possible security when different messages are encrypted with the same password. Although using the same password many times is theoretically a big no-no, in the real world it often can't be avoided.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">The lower 7 bits of each character in the password are packed into an array, which is used to set the encryption key. The ICE encryption algorithm can operate at different levels, with higher levels using longer keys and providing more security. The ICE level appropriate for the password length is used.</span></i></blockquote><blockquote class="tr_bq"><i><span style="font-size: x-small;">CFB mode makes use of an initialization vector (IV), which is initially set to the first 64 bits of the key encrypted by itself. Each time a bit is encrypted, the IV is encrypted, and the leftmost bit of the encrypted IV is XORed with the bit. The IV is then shifted left one bit, and the ciphertext bit is added to the right. Decryption reverses this process.</span></i></blockquote></blockquote><b>My dream. . .</b><br />One of the first applications for SNOW that was described to me was for HTML files. Most people never look at the source code for a webpage, and when they do, they are often greeted by VERY large files filled with code that only developers (and sometimes only the one who built it) understand.<br /><br />My professor joked that "there could be a whole network of spies out there using this on the internet right now for all we know."<br /><br />Though fascinated by the technology, I found it odd that one would have to use a command line program to decrypt. Users would first have to know exactly which webpage has a secret message. They would then have to manually download the source, run the program on the command line, and follow this process for each password they wish to try.<br /><br />I settled on a fairly simple vision: Let web browsers detect and attempt to decrypt hidden messages automatically while the user browses the web…without thinking and with minimal effort.<br /><br />I later found a more innovative question: What if the hidden message was HTML code? Could we somehow re-render the webpage and display a website that only certain users are supposed to see? What if this could serve as the beginning foundation for a new layer of web security?<br /><br /><b>Taking it further. . .</b><br />A lot of tools had already been created for SNOW. In addition to the original command line version, an <a href="http://www.darkside.com.au/snow/jsnowapp.html">applet</a> and&nbsp;<a href="http://fog.misty.com/perry/ccs/snow/snow/snow.html">CGI</a>&nbsp;versions were also created.<br /><br />But all of these tools assume that you want to encrypt/decrypt a file and all of the original code is based around command line interaction. So I started with the Java version of SNOW, created a generic interface that takes a URL (instead of a file) in addition to other parameters and then created a JAR file that anyone could&nbsp;incorporate into a development project.<br /><br />Having a JAR file was important as I had already decided that I wanted to build a SNOW based Firefox extension. Although not a standard part of Firefox&nbsp;extension&nbsp;development, several tools already existed for calling JAR files from plugin code.<br /><br />With the Java end of things complete, I next focused on building a Firefox&nbsp;extension&nbsp;(version 3.6). The basics of a&nbsp;extension&nbsp;were very easy, just some JavaScript and XUL (an XML type language used by Firefox) code. The hard parts were making calls to the JAR file and getting the UI to look just the way I wanted. Some screen shots are below.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-uNrDYgdfBoE/UI2qWxFGbiI/AAAAAAAAAPc/Kf-00PUspYs/s1600/installed.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="164" src="http://3.bp.blogspot.com/-uNrDYgdfBoE/UI2qWxFGbiI/AAAAAAAAAPc/Kf-00PUspYs/s400/installed.png" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-3ZZTY_uLaX8/UI2qWr1gYAI/AAAAAAAAAPU/gDmIDp9gO6g/s1600/hidden_message.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="138" src="http://3.bp.blogspot.com/-3ZZTY_uLaX8/UI2qWr1gYAI/AAAAAAAAAPU/gDmIDp9gO6g/s400/hidden_message.jpg" width="400" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-oxUtSVlwBiA/UI2qXHzHU8I/AAAAAAAAAPk/IoYFpj3kztY/s1600/password.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="196" src="http://1.bp.blogspot.com/-oxUtSVlwBiA/UI2qXHzHU8I/AAAAAAAAAPk/IoYFpj3kztY/s400/password.jpg" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-HIgHOFJDpsQ/UI2qXkY5rSI/AAAAAAAAAPs/nkVB9LfOnbk/s1600/visible_message.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="135" src="http://4.bp.blogspot.com/-HIgHOFJDpsQ/UI2qXkY5rSI/AAAAAAAAAPs/nkVB9LfOnbk/s400/visible_message.jpg" width="400" /></a></div><br /><br /><b>The state of things today:</b><br />I was in the long process of getting the&nbsp;extension&nbsp;officially approved by Mozilla, but in the middle of things they changed some of their quality standards. By the time I got around to taking another look, they had upgraded a couple of versions and there was talk of all&nbsp;extensions being moved to HTML5. As a result, you can't really use the&nbsp;extension&nbsp;unless you have Firefox 3.6 and install in manually.<br /><br />If you would like to install it though, you can download a copy <a href="http://fog.misty.com/SNOWFox/">here</a>. That page also has a secret message embedded in the source code so you can test that it's working properly. (I think the password is "ice") If you install it correctly and give it the proper password, the webpage itself actually changes. (See screenshots below) You can also find a copy of the detailed <a href="http://fog.misty.com/SNOWFox/snowfox_paper.pdf">report I wrote</a>.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-7_sj9HCk74g/UI2v2d-TGgI/AAAAAAAAAP8/4ZwtpYttgD0/s1600/hidden_code.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="66" src="http://4.bp.blogspot.com/-7_sj9HCk74g/UI2v2d-TGgI/AAAAAAAAAP8/4ZwtpYttgD0/s400/hidden_code.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ezsIjD0BMds/UI2v2u9UX8I/AAAAAAAAAQE/fLs_jRsvUdE/s1600/unhidden_code.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="66" src="http://2.bp.blogspot.com/-ezsIjD0BMds/UI2v2u9UX8I/AAAAAAAAAQE/fLs_jRsvUdE/s400/unhidden_code.png" width="400" /></a></div><br /><b>The future:</b><br />The&nbsp;extension&nbsp;itself is a little resource heavy (in my opinion). It also produces some false positives (a good thing?) and isn't as smart as it could be. So there is some polish that needs to be done. In addition, I'd like to get it working with newer browsers and have it as an officially approved install.<br /><br />I plan to explore the use of snow with authentication tokens assigned to users by a given website. Also, for developers, I want to create a command line program to “snowstorm” their website. The developer will feed it the path to their source code and the program fills every file with random, useless snow. Then, the developer can pick individual files to put a real message into. Suddenly, it becomes a lot harder to know which web pages have snow and which don’t.<br /><br />Beyond these basic ideas, there are a LOT of ideas I have for taking this concept to the next level and actually making it a useful tool that people would want to leverage as a potentially new layer of web security.<br /><br />
